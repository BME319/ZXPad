<!DOCTYPE html >
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="stylesheet" href="css/jquery.mobile-1.4.2.css" />
<link href="css/jquery.dataTables.css" rel="stylesheet" type="text/css" />
<script src="js/jquery-2.1.3.js"></script>
<script src="js/jquery.mobile-1.4.2.js"></script>
<script type="text/javascript" src="js/jquery.dataTables.js"></script>
<script type="text/javascript" src="js/CommonUtility.js"></script>
	<script type="text/javascript" src="js/PatientBasicInfo.js"></script>
<script type="application/javascript" src="js/iscroll.js"></script>
<link rel="stylesheet" type="text/css" href="css/scrollbar.css">
<link rel="stylesheet" type="text/css" href="css/scroll.css">
<title>患者建档</title>
<style type="text/css">

.Logo {
	float: left;
}
.clearfloat {
	clear: both;
}

.sidebar{
	padding-left: 6%;
	list-style-type: none;
}

.mainInfo {
	padding-left: 10px;
	padding-right: 10px;
	width: 95%;
	float: left;
	
}
div#ModuleInfoDiv.ui-grid-a .ui-block-a {
	height: auto;
	width: 30%;
	font-weight: bold;
	//text-align: center;
 //border: 1px solid #F00;
}
div#ModuleInfoDiv.ui-grid-a .ui-block-b {
	height: auto;
	width: 70%;
	font-weight: bold;
	//text-align: center;
 //border: 1px solid #F00;
}


</style>
   <style type="text/css">
  	div#DoctorInfoDiv.ui-grid-a .ui-block-a { width: 25%; text-align: center;} 
	div#DoctorInfoDiv.ui-grid-a .ui-block-b { width: 75%}
	div#BasicInfoDiv.ui-grid-c .ui-block-a { width: 46%} 
	div#BasicInfoDiv.ui-grid-c .ui-block-b { width: 4%} 
	div#BasicInfoDiv.ui-grid-c .ui-block-c { width: 46%}
	div#BasicInfoDiv.ui-grid-c .ui-block-d { width: 4% }
   </style>
</head>

<body>

<div data-role="page" id="BasicInfoPage">
<div data-position="fixed" data-role="header" data-theme="a" data-tap-toggle="false" style="height:45px"> 
    <a href="javascript: location.href='HomePage.html?';"   data-icon="home" data-iconpos="notext" data-shadow="false" data-iconshadow="false" >主页</a> 

<!--<a href="HomePage.html"> <img src = "img/avatar.jpg" id="docimg" value="" style="height:30px"/> </a>-->
  <h1>患者信息 </h1>

</div>

	<div data-role="navbar" data-position="fixed">
		<div class="ui-grid-b">
			<div class="ui-block-a"><a data-role="button" data-transition="slidefade" data-theme="a" href="#BasicInfoPage"> 基本信息 </a><br>
			</div>
			<div class="ui-block-b"> <a data-role="button" data-transition="slidefade" data-theme="a" href="#ModuleInfoPage" > 慢病信息 </a><br>
			</div>
			<div class="ui-block-c"><a data-role="button" data-transition="slidefade" data-theme="a" href="#InvitationInfoPage"> 发送邀请 </a><br>
			</div>
		</div>
	</div>
	<div data-role="content">
 <div class="ui-grid-a" id="DoctorInfoDiv">      
    <div class="ui-block-a">
      <div>
        <img id="Photo" name="Photo" style="max-height:200px; max-width:200px"/> 
      </div>
      <div>
        <label for="UserId" id="UserId"></label>
        <label for="UserName" id="UserName"></label>
      </div>
    </div>
  
    <div class="ui-block-b">  
      <div class="ui-grid-c" id="BasicInfoDiv">
        <div class="ui-block-a">
          <div data-role="fieldcontain">
            <label for="SexType">*性别</label>
            <select name="SexType" id="SexType" style="height:40px"></select>
          </div>
          <div data-role="fieldcontain">    
            <label for="SexStyle" id="SexStyle"></label>
            <label for="AlertSex" id="AlertSex" style="color:red">性别必填</label>
          </div>
          <div data-role="fieldcontain">
            <label for="Birthday">*出生日期</label> 
            <input type="date" name="Birthday" id="Birthday" style="height:40px">
          </div>
          <div data-role="fieldcontain">
            <label for="BirthStyle" id="BirthStyle"></label>
            <label for="AlertBirth" id="AlertBirth" style="color:red">生日必填</label>
          </div>
          <div data-role="fieldcontain">
            <label for="AboBloodType">血型</label>
            <select name="AboBloodType" size="1" id="AboBloodType" style="height:40px"></select>
          </div>
          <div data-role="fieldcontain">
            <label for="Height">身高</label>
            <input type="text" name="Height" id="Height" style="height:40px">
          </div>
          <div data-role="fieldcontain">
            <label for="Weight">体重</label>
            <input type="text" name="Weight" id="Weight" style="height:40px">  
          </div>
          <div data-role="fieldcontain">
            <label for="InsuranceType">医保类型</label>
            <select name="InsuranceType" id="InsuranceType" style="height:40px"></select>
          </div>
        </div>
        <div class="ui-block-b"></div>
        <div class="ui-block-c"> 
          <div data-role="fieldcontain">
            <label for="IDNo">身份证号码</label>
            <input type="text" name="IDNo" id="IDNo" style="height:40px; width:200px"> 
          </div>
          <div data-role="fieldcontain">
            <label for="IDStyle" id="IDStyle"></label>
            <table>
              <label for="AlertID" id="AlertID" style="color:red; width:200px">身份证号码必须为15位或18位</label>
            </table>
          </div>
          <div data-role="fieldcontain">
            <label for="PhoneNumber">联系电话</label>
            <input type="text" name="PhoneNumber" id="PhoneNumber" style="height:40px">
          </div>
          <div data-role="fieldcontain">
            <label for="PhoneStyle" id="PhoneStyle"></label>
            <table>
              <label for="AlertPhone" id="AlertPhone" style="color:red; width:200px">联系电话必须为手机或座机号</label>
            </table>
          </div>
          <div data-role="fieldcontain">
            <label for="HomeAddress">家庭住址</label>
            <input type="text" name="HomeAddress" id="HomeAddress" style="height:40px"> 
          </div>
          <div data-role="fieldcontain">
            <label for="Nationality">国籍</label>
            <input type="text" name="Nationality" id="Nationality" style="height:40px">
          </div>
          <div data-role="fieldcontain">
            <label for="Occupation">职业</label>
            <input type="text" name="Occupation" id="Occupation" style="height:40px">
          </div>
          <div data-role="fieldcontain">
            <label for="EmergencyContact">紧急联系人</label>
            <input type="text" name="EmergencyContact" id="EmergencyContact" style="height:40px">
          </div>
          <div data-role="fieldcontain">
             <label for="EmergencyContactPhoneNumber">紧急联系人电话</label>
             <input type="text" name="EmergencyContactPhoneNumber" id="EmergencyContactPhoneNumber" style="height:40px">
          </div>        
        </div> 
        <div class="ui-block-d"></div>
      </div> 
    </div>  
		<div>
			<input type="text" name="DoctorId" id="DoctorId" data-role="none" style="display: none;">
			<input type="text" name="InvalidFlag" id="InvalidFlag" data-role="none" style="display: none;">
			<input type="text" name="Flag" id="Flag" data-role="none" style="display: none;">
		</div>
		<div style="text-align:center">
			<input type="button" data-inline="true" id = "Reset" value="重置" onclick = "ResetInfo();" />
			<input type="button" data-inline="true" id = "Save" value="保存" onclick = "SaveInfo();" />
		</div>
	</div>
	<div data-theme="a" data-role="footer" data-position="fixed">
		<h3> copyright </h3>
	</div>
</div>


<div data-role="page" id="ModuleInfoPage">
<div data-position="fixed" data-role="header" data-theme="a" data-tap-toggle="false" style="height:45px"> 
    <a href="javascript: location.href='HomePage.html?';"   data-icon="home" data-iconpos="notext" data-shadow="false" data-iconshadow="false" >主页</a> 

  <h1>患者信息 </h1>

</div>
	<div data-role="navbar" data-position="fixed">
		<div class="ui-grid-b">
			<div class="ui-block-a"><a data-role="button" data-transition="slidefade" data-theme="a" href="#BasicInfoPage"
        > 基本信息 </a><br>
			</div>
			<div class="ui-block-b"> <a data-role="button" data-transition="slidefade" data-theme="a" href="#ModuleInfoPage"
        > 慢病信息 </a><br>
			</div>
			<div class="ui-block-c"><a data-role="button" data-transition="slidefade" data-theme="a" href="#InvitationInfoPage"			> 发送邀请 </a><br>
			</div>
		</div>
	</div>
	<div data-role="content">
		<div class="ui-grid-a" id="ModuleInfoDiv">
			<div class="ui-block-a">
				<ul class="sidebar">
					<li><input type="button" data-inline="true" data-theme="a" data-icon="check" data-iconpos="left" class="modulesbought" name="M1" value="高血压模块"></li>
				</ul>
			</div>
			<div class="ui-block-b">
				<input type="button" data-inline="true" data-transition="turn" data-theme="a"
        onclick="edit()" data-icon="edit" data-iconpos="left" value="编辑" id="editModuleInfo">
				<input type="button" data-inline="true" data-transition="turn" data-theme="a" 
        onclick="save()" data-icon="check" data-iconpos="left" value="保存" id="saveModuleInfo">
				<div class="mainInfo" data-role="listview"> 
				
				
					<!--<h3> 详细信息 </h3>--> 
					<!--健康信息加载--> 
					
				</div>
			<!--<input type="button" data-inline="true" data-transition="turn" data-theme="a"
        onclick="edit()" data-icon="edit" data-iconpos="left" value="编辑" id="editModuleInfo">
				<input type="button" data-inline="true" data-transition="turn" data-theme="a" 
        onclick="save()" data-icon="check" data-iconpos="left" value="保存" id="saveModuleInfo">-->
			</div>
		</div>
		
		<!--<div class="clearfloat"></div>--> 
		
	</div>
	<div data-theme="a" data-role="footer" data-position="fixed">
		<h3> copyright </h3>
	</div>
</div>

</body>
<script>
<!--全局变量-->
/*
	var revUserId = "zcy";
	var TerminalName = "zcy-PC";
	var TerminalIP = "10.12.43.35";
	var DeviceType = "1";*/
	
		var revUserId = localStorage.getItem('UserId');
	var TerminalName = localStorage.getItem('TerminalName');
	var TerminalIP = localStorage.getItem('TerminalIP');
	var DeviceType = localStorage.getItem('DeviceType');
			
	//var UserId = "PID201501070003";
	var UserId = localStorage.getItem("PatientId");
//	var CategoryCode = "M1";
	var CategoryCode = localStorage.getItem("ModuleType");
	console.log("module is " + CategoryCode);
	var CategoryName = "高血压模块";
	
	//Check network
	ConnectWebserivce();

		
$(document).ready(function(event){
				
 	GetTypeList("SexType");
	GetTypeList("AboBloodType");
	GetTypeList("InsuranceType");
	
	
	GetDetailInfo(UserId);
 	GetBasicInfo(UserId);
	GetUserBasicInfo(UserId);
});
/*
function ResetInfo()
{
	var UserId = document.getElementById("UserId").value;
	GetDetailInfo(UserId);
 	GetBasicInfo(UserId);
}

function SaveInfo()
{
	var UserName = document.getElementById("UserName").value;
	var Gender = document.getElementById("SexType").value;
	var Birthday = document.getElementById("Birthday").value;
	var length = $("#IDNo").val().length;

	if(length != 15 && length != 18)
	{
		alert("证件号码格式不正确，请重新输入！");
		document.getElementById("IDNo").style.backgroundColor = "red";	
		return false;
	}
	else if (UserName == "" || Gender == "0" || Birthday == "")
	{
		alert("打*为必填信息，请完善基本信息！");
		if (UserName == "") 
		{
			document.getElementById("UserName").style.backgroundColor = "red";
		}
		else
		{
			document.getElementById("UserName").style.backgroundColor = "white";
		}
		if (Gender == "0") 
		{
			document.getElementById("SexType").style.backgroundColor = "red";
		}
		else
		{
			document.getElementById("SexType").style.backgroundColor = "white";
		}
		if (Birthday == "") 
		{
			document.getElementById("Birthday").style.backgroundColor = "red";
		}	
		else
		{
			document.getElementById("Birthday").style.backgroundColor = "white";
		}
		return false;
	}
	else
	{
		document.getElementById("IDNo").style.backgroundColor = "white";
		document.getElementById("UserName").style.backgroundColor = "white";
		document.getElementById("SexType").style.backgroundColor = "white";
		document.getElementById("Birthday").style.backgroundColor = "white";
		
		var r = confirm("是否确定保存");
		if (r==true)
  		{
  			var UserId = document.getElementById("UserId").value;
			var IDNo = document.getElementById("IDNo").value;
			var BloodType = document.getElementById("AboBloodType").value;
			var Height = document.getElementById("Height").value;
			var Weight = document.getElementById("Weight").value;
			var InsuranceType = document.getElementById("InsuranceType").value;
			//var InsuranceType = $("#InsuranceType").find("option:selected").text();
			var PhoneNumber = document.getElementById("PhoneNumber").value;
			var HomeAddress = document.getElementById("HomeAddress").value;
			var Nationality = document.getElementById("Nationality").value;
			var Occupation = document.getElementById("Occupation").value;
			var EmergencyContact = document.getElementById("EmergencyContact").value;
			var EmergencyContactPhoneNumber = document.getElementById("EmergencyContactPhoneNumber").value;
			var DoctorId = document.getElementById("DoctorId").value;
			var InvalidFlag = document.getElementById("InvalidFlag").value;
			
			var ItemSeq = "1";
			var Description = null;
			var SortNo = "1";
			var Birthday = Birthday.replace("-","");
			var Birthday = Birthday.replace("-","");
			
			SetBasicInfo(UserId, UserName, Birthday, Gender, BloodType, IDNo, DoctorId, InsuranceType, InvalidFlag, revUserId, TerminalName, TerminalIP, DeviceType);
			var Flag = document.getElementById("Flag").value;
			SetDetailInfo(UserId, "Contact", "Contact001_1", ItemSeq, IDNo, Description, SortNo, revUserId, TerminalName, TerminalIP, DeviceType);
			var Flag1 = document.getElementById("Flag").value;
			SetDetailInfo(UserId, "Contact", "Contact001_2", ItemSeq, Occupation, Description, SortNo, revUserId, TerminalName, TerminalIP, DeviceType);
			var Flag2 = document.getElementById("Flag").value;
			SetDetailInfo(UserId, "Contact", "Contact001_3", ItemSeq, Nationality, Description, SortNo, revUserId, TerminalName, TerminalIP, DeviceType);
			var Flag3 = document.getElementById("Flag").value;
			SetDetailInfo(UserId, "Contact", "Contact002_1", ItemSeq, PhoneNumber, Description, SortNo, revUserId, TerminalName, TerminalIP, DeviceType);
			var Flag4 = document.getElementById("Flag").value;
			SetDetailInfo(UserId, "Contact", "Contact002_2", ItemSeq, HomeAddress, Description, SortNo, revUserId, TerminalName, TerminalIP, DeviceType);
			var Flag5 = document.getElementById("Flag").value;
			SetDetailInfo(UserId, "Contact", "Contact002_3", ItemSeq, EmergencyContact, Description, SortNo, revUserId, TerminalName, TerminalIP, DeviceType);
			var Flag6 = document.getElementById("Flag").value;
			SetDetailInfo(UserId, "Contact", "Contact002_4", ItemSeq, EmergencyContactPhoneNumber, Description, SortNo, revUserId, TerminalName, TerminalIP, DeviceType);
			var Flag7 = document.getElementById("Flag").value;
			SetDetailInfo(UserId, "BodySigns", "Height", ItemSeq, Height, Description, SortNo, revUserId, TerminalName, TerminalIP, DeviceType);
			var Flag8 = document.getElementById("Flag").value;
			SetDetailInfo(UserId, "BodySigns", "Weight", ItemSeq, Weight, Description, SortNo, revUserId, TerminalName, TerminalIP, DeviceType);
			var Flag9 = document.getElementById("Flag").value;

			if (Flag == "true" && Flag1 == "true" && Flag2 == "true" && Flag3 == "true" && Flag4 == "true" && Flag5 == "true" && Flag6 == "true" && Flag7 == "true" && Flag8 == "true" && Flag9 == "true")
			{
				alert("基本信息保存成功！")
			}
			else
			{
				alert("基本信息保存失败！")
			}
  		}
	}
}

function SetBasicInfo (UserId, UserName, Birthday, Gender, BloodType, IDNo, DoctorId, InsuranceType, InvalidFlag, revUserId, TerminalName, TerminalIP, DeviceType)
{
  $.ajax({
    type: "POST",
    dataType: "xml",
    timeout: 30000,
	url: 'http://'+ serverIP +'/'+serviceName+'/SetPatBasicInfo',
    async: false,
	data: 
	{
		UserId: UserId,
		UserName: UserName,
		Birthday: Birthday,
		Gender: Gender,
		BloodType: BloodType,
		IDNo: IDNo,
		DoctorId: DoctorId,
		InsuranceType: InsuranceType,
		InvalidFlag: InvalidFlag,
		revUserId: revUserId,
		TerminalName: TerminalName,
		TerminalIP: TerminalIP,
		DeviceType: DeviceType
	},
    beforeSend: function() {
   },
    success: function(result) {      	  
		var Flag = $(result).find("boolean ").text();
		$("#Flag").val(Flag);
    },
    error: function(msg) {
      alert("SetPatBasicInfo出错啦！");
    }
  });
}

function SetDetailInfo(Patient, CategoryCode, ItemCode, ItemSeq, Value, Description, SortNo, revUserId, TerminalName, TerminalIP, DeviceType)
{
  $.ajax({
    type: "POST",
    dataType: "xml",
    timeout: 30000,
	url: 'http://'+ serverIP +'/'+serviceName+'/SetPatBasicInfoDetail',
    async: false,
	data: 
	{
		Patient: Patient,
		CategoryCode: CategoryCode,
		ItemCode: ItemCode,
		ItemSeq: ItemSeq,
		Value: Value,
		Description: Description,
		SortNo: SortNo,
		revUserId: revUserId,
		TerminalName: TerminalName,
		TerminalIP: TerminalIP,
		DeviceType: DeviceType
	},
    beforeSend: function() {
   },
    success: function(result) {
		Flag = $(result).find("boolean ").text();
		$("#Flag").val(Flag);
    },
    error: function(msg) {
      alert("SetPatBasicInfoDetail出错啦！");
    }
  });
}

function GetUserBasicInfo (UserId)
{
  $.ajax({
    type: "POST",
    dataType: "xml",
    timeout: 30000,
	url: 'http://'+ serverIP +'/'+serviceName+'/GetUserBasicInfo',
    async: false,
	data: 
	{
		UserId: UserId
	},
    beforeSend: function() {
   },
    success: function(result) {      	  
		var DoctorId = $(result).find("PatientALLBasicInfo").find("DoctorId").text();
		var InvalidFlag = $(result).find("PatientALLBasicInfo").find("InvalidFlag").text();
		$("#DoctorId").val(DoctorId);
		$("#InvalidFlag").val(InvalidFlag);
    },
    error: function(msg) {
      alert("GetPatBasicInfo出错啦！");
    }
  });
}

function GetBasicInfo (UserId)
{
  $.ajax({
    type: "POST",
    dataType: "xml",
    timeout: 30000,
	url: 'http://'+ serverIP +'/'+serviceName+'/GetPatBasicInfo',
    async: false,
	data: 
	{
		UserId: UserId
	},
    beforeSend: function() {
   },
    success: function(result) {      	  
		var UserId = $(result).find("PatientBasicInfo").find("UserId").text();
		var UserName = $(result).find("PatientBasicInfo").find("UserName").text();
        var Gender = $(result).find("PatientBasicInfo").find("Gender").text();
        var BloodType = $(result).find("PatientBasicInfo").find("BloodType").text();
        var InsuranceType = $(result).find("PatientBasicInfo").find("InsuranceType").text();
        var Birthday = $(result).find("PatientBasicInfo").find("Birthday").text();
        var BloodTypeText = $(result).find("PatientBasicInfo").find("BloodTypeText").text();
        var InsuranceTypeText = $(result).find("PatientBasicInfo").find("InsuranceTypeText").text();
        var Module = $(result).find("PatientBasicInfo").find("Module").text();

		$("#UserId").val(UserId);
		$("#UserName").val(UserName);
		var Birthday = Birthday.substring(0,4) + "-" + Birthday.substring(4,6) + "-" + Birthday.substring(6,8);
		$("#Birthday").val(Birthday);
		$("#SexType").val(Gender);
		$('#SexType').selectmenu('refresh');
		$("#AboBloodType").val(BloodType); 
		$('#AboBloodType').selectmenu('refresh');
		$("#InsuranceType").val(InsuranceType); 
		$('#InsuranceType').selectmenu('refresh');
    },
    error: function(msg) {
      alert("GetPatBasicInfo出错啦！");
    }
  });
}
*/
/*
function GetDetailInfo (UserId)
{
  $.ajax({
    type: "POST",
    dataType: "xml",
    timeout: 30000,
	url: 'http://'+ serverIP +'/'+serviceName+'/GetPatientDetailInfo',
    async: false,
	data: 
	{
		UserId: UserId
	},
    beforeSend: function() {
   },
    success: function(result) {          	  
		var UserId = $(result).find("PatientDetailInfo1").find("UserId").text();
		var PhoneNumber = $(result).find("PatientDetailInfo1").find("PhoneNumber").text();
        var HomeAddress = $(result).find("PatientDetailInfo1").find("HomeAddress").text();
        var Occupation = $(result).find("PatientDetailInfo1").find("Occupation").text();
        var Nationality = $(result).find("PatientDetailInfo1").find("Nationality").text();
        var EmergencyContact = $(result).find("PatientDetailInfo1").find("EmergencyContact").text();
        var EmergencyContactPhoneNumber = $(result).find("PatientDetailInfo1").find("EmergencyContactPhoneNumber").text();
        var PhotoAddress = $(result).find("PatientDetailInfo1").find("PhotoAddress").text();
        var Module = $(result).find("PatientDetailInfo1").find("Module").text();
        var IDNo = $(result).find("PatientDetailInfo1").find("IDNo").text();
		var Height = $(result).find("PatientDetailInfo1").find("Height").text();
		var Weight = $(result).find("PatientDetailInfo1").find("Weight").text();

		$("#PhoneNumber").val(PhoneNumber);
		$("#HomeAddress").val(HomeAddress);
		$("#Occupation").val(Occupation);
		$("#Nationality").val(Nationality);
		$("#EmergencyContact").val(EmergencyContact);
		$("#EmergencyContactPhoneNumber").val(EmergencyContactPhoneNumber);
		$("#IDNo").val(IDNo);
		$("#Height").val(Height);
		$("#Weight").val(Weight);
    },
    error: function(msg) {
      alert("GetPatientDetailInfo出错啦！");
    }
  });
}

function GetTypeList (Category)
{
	$("#"+Category).append('<option value=0>--请选择--</option>');
	
	$.ajax({
    type: "POST",
    dataType: "xml",
    timeout: 30000,
	url: 'http://'+ serverIP +'/'+serviceName+'/GetTypeList',
    async: false,
	data: 
	{
		Category: Category
	},
    beforeSend: function() {
    },
    success: function(result) {
		$(result).find('Table1').each(function() {
			var Type = $(this).find("Type").text();
			var Name = $(this).find("Name").text();
			$("#"+Category).append('<option value='+Type+'>'+Name+'</option>');
		})	  
    },
    error: function(msg) {
      alert("GetTypeList出错啦！");
    }
  });
}*/

</script>
<script type="text/javascript">	
		
		
   $(document).ready(function () {	 
	   //if(window.localStorage){
 			//alert('This browser supports localStorage');
			//localStorage.setItem("UserId","PID201501070003");
			//localStorage.setItem("CategoryCode","M1");
		//}else{
 			//alert('This browser does NOT support localStorage');
		//}

		//UserId = localStorage.getItem("UserId");
		//CategoryCode = localStorage.getItem("CategoryCode");
		
		//var test = GetOptionList("YesNoType","1");
		//var test = getResults();
		//alert("test="+test);

		GetItemInfoByPIdAndModule(UserId,CategoryCode,CategoryName);	
		//$(".mainInfo label").css("width","20%");
		//$(".dropdrowlist").css("width","60%").parent().css("width","60%");
		//$(".textbox").css("width","60%").parent().css("width","60%");	
   })
	
	
//页面由不可编辑状态切换到可编辑状态
	function edit(){
		
		$(".dropdrowlist").removeAttr("disabled").parent().removeClass("ui-state-disabled");
		$(".textbox").removeAttr("disabled").parent().removeClass("ui-state-disabled");	
				
		$("#saveModuleInfo").removeAttr("disabled").parent().removeClass("ui-state-disabled");
		$("#editModuleInfo").attr("disabled","disabled").parent().addClass("ui-state-disabled");
	}
	
//函数GetItemInfoByPIdAndModule：获得患者某个购买模块的详细信息		
  function GetItemInfoByPIdAndModule(UserId,CategoryCode,CategoryName){
	  
	$.ajax({  
        type: "POST",
        dataType: "xml",
		timeout: 30000,  
		url: 'http://'+ serverIP +'/'+serviceName+'/GetItemInfoByPIdAndModule',
		async:false,
        data: {PatientId:UserId,CategoryCode:CategoryCode},
		beforeSend: function(){},
        success: function(result) { 
			 $(".mainInfo").append('<h2>' + CategoryName + '详细信息</h2>');
			 $(result).find('Table1').each(function() {
				 var ItemCode = $(this).find("ItemCode").text();
				 if(ItemCode!="InvalidFlag")
				 {
					 if(ItemCode=="Doctor")
					 {
						 var ItemName = $(this).find("ItemName").text(); //负责医生
						 var ParentCode = $(this).find("ParentCode").text(); //ParentCode：为空，没有父级标题
						 var Value = $(this).find("Value").text(); //暂时不用
						 var Description = $(this).find("Description").text(); //负责医生姓名，不可编辑
						 var DoctorInfo = '<div data-role="fieldcontain"><label>' + ItemName + '</label><label>' + Description + '</label></div>';
						 $(".mainInfo").append(DoctorInfo);
					 }
					 else
					 {
						 var ItemName = $(this).find("ItemName").text(); //问卷内容
						 var ParentCode = $(this).find("ParentCode").text(); //ParentCode
						 var ControlType = $(this).find("ControlType").text(); //
						 var OptionCategory = $(this).find("OptionCategory").text(); //
						 //alert(OptionCategory);
						 var Value = $(this).find("Value").text(); //
						 var Content = $(this).find("Content").text(); //
						 //增加下拉框  
						 if(OptionCategory!="")
						 {
						 	var OptionList = GetOptionList(OptionCategory,Value);
						 }
						 
						 
						 if(ParentCode=="")
						 {
							 var ModuleInfo = '<label><strong>' + ItemName + '</strong></label>';
							 $(".mainInfo").append(ModuleInfo);

						 }
						 else
						 {	
						 	if(ControlType==1)	//下拉框
							{
								var ModuleInfo = '<div class="' + ItemCode + '" data-role="fieldcontain"><label>' + ItemName + '</label>' + '<select class="dropdrowlist">' + OptionList + '</select></div>';							
							}
							else		//自由文本
							{	
							 	var ModuleInfo = '<div class="' + ItemCode + '" data-role="fieldcontain"><label>' + ItemName + '</label>' + '<input type="text" class="textbox" value=' + Content + '></div>';
							}
							$(".mainInfo").append(ModuleInfo);
						 }
					
					 }
				 }			 
			});	
			$(".dropdrowlist").attr("disabled","disabled");
			$(".textbox").attr("disabled","disabled");
			$("#saveModuleInfo").attr("disabled","disabled");			    				
			$(".mainInfo").trigger("create");  //jquery mobile渲染	
	   }, 
       error: function(msg) {alert("Error!");}
     });
  }

//生成带值的下拉框
	function GetOptionList(Type,Value){
		var options;
		$.ajax({  
        type: "POST",
        dataType: "xml",
		timeout: 30000,  
		url: 'http://'+ serverIP +'/'+serviceName+'/GetTypeList',
		async:false,
        data: {Category:Type},
		beforeSend: function(){},
        success: function(result) { 
			if(Value!="")
			{
				options = '<option value="0">请选择</option>';
			 	$(result).find('Table1').each(function() {
				 	var Type = $(this).find("Type").text();
				 	var Name = $(this).find("Name").text(); 
					if(Type==Value)
					{
						options = options + '<option value="' + Type + '" selected="selected">' + Name + '</option>';
					}
				 	else
					{
				 		options = options + '<option value="' + Type + '">' + Name + '</option>';
					}
				})
			}
			else		//Value==""时，将下拉框中Value为0的项选中
			{
				options = '<option value="0" selected="selected">请选择</option>';
			 	$(result).find('Table1').each(function() {
				 	var Type = $(this).find("Type").text();
				 	var Name = $(this).find("Name").text(); 							 
				 	options = options + '<option value="' + Type + '">' + Name + '</option>';
				})
			}				    
       }, 
       error: function(msg) {alert("Error!");}
     });
	 return options;	
	}
	
	//表单提交，保存编辑过的健康信息
	function save(){
		
		$.ajax({  
        type: "POST",
        dataType: "xml",
		timeout: 30000,  
		url: 'http://'+ serverIP +'/'+serviceName+'/GetItemInfoByPIdAndModule',
		async:false,
        data: {PatientId:UserId,CategoryCode:CategoryCode},
		beforeSend: function(){},
        success: function(result) { 
			 $(result).find('Table1').each(function() {
				 var ItemCode = $(this).find("ItemCode").text();
				 //alert(ItemCode);
				 if(ItemCode!="InvalidFlag")
				 {
					 if(ItemCode=="Doctor")
					 {
						 //负责医生不可编辑，无需执行任何操作
					 }
					 else
					 {
						 //var ItemCode = $(this).find("ItemCode").text(); //问卷内容
						 var ParentCode = $(this).find("ParentCode").text(); //ParentCode
						 var ItemSeq = $(this).find("ItemSeq").text(); //
						 var Description = $(this).find("Description").text(); //
						 var SortNo = $(this).find("SortNo").text(); //
						 var value;			 
						 if(ParentCode=="")
						 {
							 //该条记录为父级标题，无需执行任何操作
						 }
						 else
						 {						 	
						 	//按ItemCode从界面对应元素取值
							var div = $("."+ItemCode);	
							if(div.find('select').length)
							{
								//alert("1");
								 value = div.find('select').val();
							}
							else
							{
								value = div.find('input').val();
							}
						 	//更新数据
							SetPatBasicInfoDetail(ItemCode,ItemSeq,value,Description,SortNo);
						 }					
					 }
				 }	
				 		 
			})
			//全部更新成功后
			$(".dropdrowlist").attr("disabled","disabled").parent().addClass("ui-state-disabled");
			$(".textbox").attr("disabled","disabled").parent().addClass("ui-state-disabled");	
			$("#editModuleInfo").removeAttr("disabled","disabled").parent().removeClass("ui-state-disabled");	
			$("#saveModuleInfo").attr("disabled","disabled").parent().addClass("ui-state-disabled");	
			
			    
       }, 
       error: function(msg) {alert("Error!");}
     });
	}
	
	//修改健康模块中的一条信息
	function SetPatBasicInfoDetail(ItemCode,ItemSeq,value,Description,SortNo){
		
		$.ajax({  								
        	type: "POST",
        	dataType: "xml",
			timeout: 30000,  
			url: 'http://'+ serverIP +'/'+serviceName+'/SetPatBasicInfoDetail',
			async:false,
        	data: {Patient:UserId,CategoryCode:CategoryCode,ItemCode:ItemCode,ItemSeq:ItemSeq,Value:value,Description:Description,SortNo:SortNo,revUserId:revUserId,TerminalName:TerminalName,TerminalIP:TerminalIP,DeviceType:DeviceType},
			beforeSend: function(){},
        	success: function(result) { 
				//alert("2");								 
      		}, 
       		error: function(msg) {alert("Error!");}
     	});
	}
</script>

</html>